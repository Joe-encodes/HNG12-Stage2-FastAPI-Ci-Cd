Hereâ€™s a **better-formatted version** of your README. I've organized it into clear sections with proper headings, bullet points, and code blocks for readability:

---

# FastAPI Book Management API

## Overview

This project is a RESTful API built with **FastAPI** for managing a book collection. It provides comprehensive **CRUD operations** for books with proper error handling, input validation, and auto-generated documentation. The repository is set up with a complete **CI/CD pipeline**, **Dockerization**, and **Nginx integration** to ensure smooth deployments on platforms like Render.

> **Note:** Do not modify `main.py` under any circumstances as per the assignment requirements.

---

## Features

- **Book Management:** CRUD operations for managing books.
- **Missing Endpoint:** Endpoint to retrieve a book by its ID at `/api/v1/books/{book_id}`, returning a JSON response or 404 if not found.
- **Validation & Error Handling:** Uses Pydantic models for input validation and provides detailed error responses.
- **CI/CD Pipeline:**
  - **Test Pipeline:** A GitHub Actions job named `test` runs `pytest` on pull requests.
  - **Deployment Pipeline:** A job named `deploy` triggers on merging to `main` and forces the repository state (using `git fetch` and `git reset --hard`) to incorporate external changes.
- **Dockerization:** Fully containerized using an official lightweight Python image.
- **Nginx Integration:** The application is served via Nginx as a reverse proxy to correctly forward API requests.
- **Automated Documentation:** Swagger UI and ReDoc auto-generated by FastAPI.
- **Environment Configuration:** Supports environment variables and secret files for secure settings.

---

## Project Structure

```
fastapi-book-project/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ schemas.py          # Data models and in-memory database
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ books.py            # Book route handlers (CRUD operations)
â”‚   â””â”€â”€ router.py               # API router configuration
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py               # Application settings and environment variables
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_books.py           # API endpoint tests (pytest)
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml              # CI workflow for running tests (job: test)
â”‚       â””â”€â”€ deploy.yml          # Deployment workflow (job: deploy with git fetch/reset)
â”œâ”€â”€ docker-compose.yml          # (Optional) For local multi-container (FastAPI + Nginx) testing
â”œâ”€â”€ Dockerfile                  # Dockerfile to build the FastAPI application image
â”œâ”€â”€ main.py                     # Application entry point (DO NOT MODIFY)
â”œâ”€â”€ requirements.txt            # Project dependencies
â””â”€â”€ README.md                   # This file
```

---

## Technologies Used

- **Python 3.12**
- **FastAPI**
- **Pydantic**
- **Uvicorn**
- **Docker**
- **Nginx**
- **GitHub Actions (CI/CD)**
- **pytest**

---

## Installation & Local Setup

### 1. Clone the Repository

```bash
git clone https://github.com/YourUsername/HNG12-Stage2-FastAPI-Ci-Cd.git
cd HNG12-Stage2-FastAPI-Ci-Cd
```

### 2. Create and Activate a Virtual Environment

> **Note:** The `.venv` folder is for local development only and is not deployed.

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

### 4. Running the Application Locally

#### a. Without Docker (Directly with Uvicorn)

```bash
uvicorn main:app --reload
```

- **API Documentation:**
  - Swagger UI: http://localhost:8000/docs
  - ReDoc: http://localhost:8000/redoc

#### b. With Docker

```bash
docker build -t fastapi-app .
docker run -p 8000:8000 fastapi-app
```

Then, visit http://localhost:8000/docs.

#### c. With Docker Compose (FastAPI + Nginx)

```bash
docker-compose up --build
```

Then, visit http://localhost (Nginx will proxy to FastAPI).

---

## API Endpoints

### Books

- **GET `/api/v1/books/`** - Retrieve all books
- **GET `/api/v1/books/{book_id}`** - Retrieve a specific book by its ID
  - Returns a JSON response with book details or a 404 if not found.
- **POST `/api/v1/books/`** - Create a new book
- **PUT `/api/v1/books/{book_id}`** - Update an existing book
- **DELETE `/api/v1/books/{book_id}`** - Delete a book

### Health Check

- **GET `/healthcheck`** - Check API status

---

## CI/CD Pipeline

### Continuous Integration (CI)

- **Workflow File:** `.github/workflows/ci.yml`
- **Job Name:** `test`
- **Action:** Runs `pytest` on every pull request to the `main` branch to ensure all tests pass.

### Continuous Deployment (CD)

- **Workflow File:** `.github/workflows/deploy.yml`
- **Job Name:** `deploy`
- **Action:** On merging to `main`, the `deploy` job triggers and updates the deployed site.
- **Important:** To ensure external modifications (e.g., a BOT adding an endpoint) are incorporated, the deploy script runs:
  ```bash
  git fetch origin main
  git reset --hard origin/main
  ```
  This ensures that the server always matches the remote repository.

---

## Dockerization & Nginx Integration

### Dockerfile

The Dockerfile builds a lightweight container using an official Python image, installs dependencies, copies the application code, exposes port 8000, and starts Uvicorn:

```Dockerfile
CMD ["sh", "-c", "uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}"]
```

> **Note:** The `${PORT}` environment variable is used by deployment platforms like Render to assign a dynamic port.

### Nginx Configuration

When using Docker Compose, Nginx is configured as a reverse proxy in `nginx.conf`:

```nginx
server {
    listen 80;
    location / {
        proxy_pass http://fastapi:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

This forwards all requests to the FastAPI container.

---

## Deployment

### Deploying on Render

1. **Repository Settings:**
   - Ensure your repository is public or that Render has access to it.

2. **Render Service Configuration:**
   - **Service Type:** Docker
   - **Branch:** `main`
   - **Dockerfile Path:** `./Dockerfile`
   - **Build Command:** (Automatically detected; if needed, use `docker build -t fastapi-app .`)
   - **Start Command:**
     ```bash
     uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}
     ```
   - **Auto-Deploy:** Enabled by defaultâ€”any push to `main` triggers a deployment.

3. **Deploy Hook:** (For manual triggers, if needed.)

---

## Running Tests

Run your tests using `pytest`:

```bash
pytest
```

Ensure all tests pass before submission. The CI pipeline also runs these tests automatically.

---

## Error Handling

The API includes proper error handling for:

- Non-existent books (returns 404)
- Invalid book IDs or genres
- Malformed requests

---

## Contributing

1. **Fork the Repository**
2. **Create a Feature Branch:**
   ```bash
   git checkout -b feature/AmazingFeature
   ```
3. **Commit Your Changes:**
   ```bash
   git commit -m 'feat: Add AmazingFeature'
   ```
4. **Push to the Branch:**
   ```bash
   git push origin feature/AmazingFeature
   ```
5. **Open a Pull Request**

---

## Repository Access

Before submitting your solution, invite the `hng12-devbotops` GitHub account as a collaborator to your repository.

---

## License

This project is licensed under the **MIT License**. See the `LICENSE` file for details.

---

## Support

For support or further questions, please open an issue in the GitHub repository.

---

## Final Checklist

- **Endpoint Implementation:** `/api/v1/books/{book_id}` correctly retrieves book details.
- **CI Pipeline:** Job named `test` runs `pytest` on pull requests.
- **Deployment Pipeline:** Job named `deploy` ensures the server matches the remote state (using `git fetch` and `git reset --hard`).
- **Dockerization:** The application builds and runs as expected using Docker.
- **Nginx Integration:** API requests are correctly routed through Nginx.
- **Repository Access:** `hng12-devbotops` has been added as a collaborator.
- **Submission:** Base URL and GitHub repository URL are ready for submission.

---

This README now serves as a complete guide covering installation, local development, CI/CD, Docker, Nginx, deployment, and more. Let me know if you need any further modifications or clarifications! ðŸ˜Š
